<!--history.wxml-->
<scroll-view class="container" scroll-y>
  <!-- 标题 -->
  <view class="header">
    <text class="header-title">📅 检测历史</text>
  </view>

  <!-- 我的设备 -->
  <view class="devices-section">
    <view class="section-header">
      <text class="section-icon">📱</text>
      <text class="section-title">我的设备：</text>
    </view>
    <view class="devices-list">
      <view class="device-item" wx:for="{{devices}}" wx:key="id">
        <text class="device-bullet">•</text>
        <text class="device-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 最近检测 -->
  <view class="recent-section">
    <view class="section-header">
      <text class="section-icon">📊</text>
      <text class="section-title">最近检测：</text>
    </view>
    <view wx:if="{{recentHistory.length === 0}}" class="empty-recent">
      <text class="empty-text">暂无检测记录</text>
    </view>
    <view wx:else class="recent-list">
      <view 
        class="recent-item" 
        wx:for="{{recentHistory}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="viewDetail"
      >
        <view class="recent-date">{{item.dateShort}}</view>
        <view class="recent-score">{{item.score}}分</view>
        <text class="recent-arrow">►</text>
      </view>
    </view>
  </view>

  <!-- 健康趋势 -->
  <view class="trend-section">
    <view class="section-header">
      <text class="section-icon">📈</text>
      <text class="section-title">健康趋势：</text>
    </view>
    <view wx:if="{{trendData.length === 0}}" class="empty-chart">
      <text class="empty-text">暂无趋势数据</text>
    </view>
    <view wx:else class="chart-container">
      <!-- 简化的折线图展示 -->
      <view class="chart-area">
        <view class="chart-bars">
          <view 
            class="chart-bar" 
            wx:for="{{trendData}}" 
            wx:key="date"
            style="height: {{item.score}}%"
            title="{{item.score}}分"
          >
            <view class="bar-value">{{item.score}}</view>
          </view>
        </view>
        <view class="chart-labels">
          <text class="chart-label" wx:for="{{trendData}}" wx:key="date">{{item.date}}</text>
        </view>
      </view>
      <!-- 图表广告 -->
      <view wx:if="{{false}}" class="chart-ad">
        <text class="ad-label">数据可视化赞助</text>
      </view>
    </view>
  </view>

  <!-- 发现异常 -->
  <view wx:if="{{scoreChange < 0}}" class="alert-section">
    <view class="alert-header">
      <text class="alert-icon">🎯</text>
      <text class="alert-title">发现异常：</text>
    </view>
    <text class="alert-text">最近分数下降{{scoreChangeAbs}}%</text>
    <view class="alert-actions">
      <button class="alert-btn re-test-btn" bindtap="reTest">重新检测</button>
      <button class="alert-btn suggestion-btn" bindtap="viewSuggestions">查看建议</button>
    </view>
  </view>

  <!-- 横幅广告 -->
  <view wx:if="{{false}}" class="banner-ad">
    <view class="ad-label">广告</view>
    <view class="ad-content">
      <text class="ad-text">横幅广告 (历史列表下方)</text>
    </view>
  </view>

  <!-- 高级功能 -->
  <!-- <view class="advanced-section" wx:if="{{false}}">
    <view class="section-header">
      <text class="section-icon">💎</text>
      <text class="section-title">高级功能：</text>
    </view>
    <view class="advanced-list">
      <view class="advanced-item" bindtap="exportRecords">
        <text class="advanced-icon">📤</text>
        <text class="advanced-name">导出所有记录</text>
        <view class="advanced-badge">付费</view>
        <text class="advanced-arrow">></text>
      </view>
      <view class="advanced-item" bindtap="setReminder">
        <text class="advanced-icon">⏰</text>
        <text class="advanced-name">设置提醒检测</text>
        <view class="advanced-badge">付费</view>
        <text class="advanced-arrow">></text>
      </view>
    </view>
  </view> -->
</scroll-view>
